---
title: Awesome extendr
format: gfm
default-image-extension: ""
execute:
  echo: false
  warning: false
---

```{r}
#| label: get-metadata
source("get-pkg-metadata.R", local = new.env())
pkgs <- read.csv("extendr-pkgs.csv")
```

```{r}
#| label: badges
#| output: asis
total_downloads <- sum(pkgs[["Count"]], na.rm = TRUE)

use_badge <- function(label, message) {
  label <- gsub(" ", "_", label)
  message <- gsub(" ", "_", message)
  message <- gsub("-", "--", message)

  sprintf(
    "![Static Badge](https://img.shields.io/badge/%s-%s-%s)",
    label,
    message,
    "276DC2"
  )
}

cat(
  "[![Awesome](https://awesome.re/badge.svg)](https://awesome.re)",
  use_badge("Last Updated", format(Sys.Date())),
  use_badge("No of Packages", nrow(pkgs)),
  use_badge("CRAN Downloads", total_downloads),
  sep = "\n"
)
```

A curated list of R packages that use [extendr](https://extendr.github.io/). 
Many but not all of these are published on [CRAN](https://cran.r-project.org/).

```{r}
#| label: pkg-list
#| output: asis
list_item_template <- paste(
  "<details>",
  "  <summary>%s: %s</summary>",
  "    <ul>",
  "      <li><strong>Author:</strong> %s</li>",
  "      <li><strong>URL:</strong> %s</li>",
  "      <li><strong>Description:</strong> %s</li>",
  "      <li><strong>Downloads:</strong> %s</li>",
  "    </ul>",
  "</details>",
  sep = "\n"
)

list_items <- with(pkgs, {
  Package <- ifelse(
    is.na(URL),
    sprintf("<strong>%s</strong>", Package),
    sprintf("<a href='%s'><strong>%s</strong></a>", URL, Package)
  )

  URL <- ifelse(
    is.na(URL),
    "",
    sprintf("<a href='%s'>%s</a>", URL, URL)
  )

  sprintf(
    list_item_template,
    Package,
    Title,
    Author,
    URL,
    Description,
    Count
  )
})

cat(
  "```{=html}",
  paste0(list_items, collapse = "\n"),
  "```",
  sep = "\n"
)
```

## Add your own package

If your package is on CRAN, you do not need to worry. It will be added to this 
list automatically. If your package is *not* on CRAN but you want to promote it 
here, you will need to submit a PR. The process is very simple. All you need to
do is add a new line to `path-to-description.txt` with the path to your package 
DESCRIPTION in a remote repository with a valid connection (on GitHub, this 
requires linking to the raw content of DESCRIPTION). You can test that the path
works using `read.dcf(url(<path>))`.